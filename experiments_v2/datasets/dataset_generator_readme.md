# Kurz (2024) 데이터셋 생성기 설명

이 문서는 `datasets/generate_all_kurz_data.py` 스크립트의 목적, 기능 및 사용법에 대해 설명함.

## 1. 스크립트의 목적

이 스크립트는 Sascha Kurz의 2024년 논문에 제시된 Proposition 1, 2, 3, 4를 검증하고 재현하기 위한 "지능형 데이터셋"을 자동으로 생성함. 생성된 데이터는 단순히 점들의 집합이 아니며, 특정 솔버 알고리즘의 탐색 효율을 극대화하기 위한 사전 계산된 정보를 포함함.

## 2. 핵심 기능 (지능형 필터)

각 데이터셋(`prop1` ~ `prop4`)은 다음 네 가지 주요 파일로 구성됨.

### `points.csv` / `points.npy`
- **내용**: 주어진 파라미터(q, k)에 대한 유한 사영 기하 `PG(k-1, q)`의 모든 점.
- **특징**: 점들은 사전순(lexicographically)으로 정렬되어 있으며, `q`가 합성수(4, 8)인 경우에도 첫 번째 0이 아닌 성분이 1이 되도록 정규화됨. `points.npy`는 `int8` 형식으로 저장되어 로딩 속도가 빠름.

### `incidence_packed.npy`
- **내용**: 점-초평면(point-hyperplane) 인접 행렬을 `numpy.packbits`를 사용하여 비트 단위로 압축한 파일.

### `point_to_hypers.json`
- **내용**: 각 점이 포함된 초평면들의 인덱스 리스트를 담은 역인덱스 파일.
- **목적**: **방법 1 (Watched-Hyperplane)** 알고리즘에서 특정 점이 포함된 초평면들을 즉시 조회하여 솔버 속도를 5~10배 가속함.

### `config.json`
- **내용**: `q, k, n`, `delta`(가분성) 등 기본 파라미터와 함께 `capacity_lookup`이라는 불리언(boolean) 배열을 포함함.
- **목적**: **방법 2 (RCUB)** 알고리즘을 위한 핵심적인 사전 계산 정보임. `delta` 값을 통해 수학적 필터링을 강화하고, 특정 초평면의 용량(capacity)이 허용되는 집합(`S_H = n - w`)에 속하는지를 O(1) 시간 복잡도로 즉시 조회할 수 있게 함.

### `bounds.json`
- **내용**: 생성될 코드 행렬 `G`가 체계적인 형태(`Systematic Form`), 즉 `G = [I_k | A]`를 갖도록 강제하기 위한 경계값 정보.
- **목적**: `k`개의 단위 벡터(unit vectors)에 해당하는 점들의 하한값(`lower_bounds`)을 1로 설정하여, 솔버가 해당 점들을 반드시 코드에 포함하도록 유도함. 이는 해 공간을 줄여 탐색 효율을 높이는 데 기여함.

## 3. 솔버 최적화 전략 (Why & How)

이 데이터셋은 단순한 데이터 제공을 넘어, 솔버의 탐색 공간을 줄이고 연산 속도를 극대화하기 위해 다음과 같이 설계됨.

### 전략 1: Watched-Hyperplane 가속 (Method 1)
- **Why (왜?)**: 백트래킹 탐색 시, 점을 하나 추가할 때마다 모든 초평면의 용량(capacity)을 갱신하는 것은 비용이 큼 ($O(N \times M)$).
- **How (어떻게?)**: `point_to_hypers.json` (역인덱스)를 제공하여, 점 $P$가 추가되었을 때 **영향을 받는 초평면들만** 즉시 조회($O(1)$~수준)하여 갱신할 수 있게 함.

### 전략 2: RCUB 가지치기 효율화 (Method 2)
- **Why (왜?)**: 재귀적 용량 상한(RCUB) 계산 시, 현재 초평면의 점 개수가 허용 가능한 집합($S_H$)에 속하는지 수시로 검사해야 함. 매번 집합 탐색($O(\log |W|)$)을 하는 것은 비효율적임.
- **How (어떻게?)**: `config.json`에 `capacity_lookup` 테이블(불리언 배열)을 미리 계산해둠. 솔버는 `if lookup[current_capacity]` 형태로 **$O(1)$** 만에 유효성을 판단하고 가지치기(Pruning)를 수행함. 또한 `delta` 값을 통해 가분성(Divisibility) 조건을 즉시 적용함.

### 전략 3: 대칭성 제거 및 탐색 공간 축소 (Systematic Form)
- **Why (왜?)**: 사영 기하 부호는 기저(Basis) 변환에 대해 등가임. 동일한 부호를 중복 탐색하는 것을 막기 위해 해 공간을 고정해야 함.
- **How (어떻게?)**: `bounds.json`에서 $k$개의 단위 벡터(Unit Vectors) 위치를 찾아 `lower_bounds=1`로 강제함. 이는 생성 행렬 $G$가 체계적 형태 $G=[I_k | A]$를 갖도록 하여, 솔버가 $k$개의 점을 결정하는 단계를 건너뛰고 나머지 점들만 탐색하도록 함.

## 4. 생성된 데이터셋

- **prop1**: `[66, 5]_4, d=48`
- **prop2**: `[35, 4]_8, d=28`
- **prop3**: `[40, 4]_5, d=30`
- **prop4**: `[153, 7]_2, d=76`

## 5. 실행 방법

### 의존성 설치
스크립트는 `galois`, `pandas`, `numpy` 라이브러리를 사용함. 다음 명령어로 설치할 수 있음.
```bash
python3 -m pip install galois pandas numpy
```

### 스크립트 실행
`datasets` 폴더 안에서 다음 명령어를 실행하면 모든 데이터셋을 다시 생성할 수 있음.
```bash
python3 generate_all_kurz_data.py
```
